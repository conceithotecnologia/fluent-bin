/*==================================================================================================================================
| Empresa..: MultCont Informática                                                                                                  |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Autor....: Jurandy da Silva Costa                                                                                                |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Data.....: 12/04/2006 21:00:00                                                                                                   |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Tipo.....: Stored Procedure                                                                                                      |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Descrição: Validação da prorrogação de vencimentos - Contas a Receber - tabela FBR                                               |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Parametros                                                                                                                       |
|  [Saída]························································································································ |
          Integer
==================================================================================================================================*/
Create Or Replace Function mc_whenfbr####???
(  Out out_res integer )
As $$

Declare
   dVencto     Date;
   dVenctoR    Date;          
   iRecno      Integer;
Begin
   out_res := 0;

   -- Busca as datas de vencimento
   Select sys_042date####???('fbr_vencia')   Into dVencto;
   Select sys_042date####???('fbr_vencia_r') Into dVenctoR;

   -- Caso a baixa ainda não tenha sido inicializada
   If dVencto Is Null Or dVenctoR Is Null Then
      -- Busca o número de registro no cabeçalho do Título
      Select integer_
        Into iRecno
        From [(ss042)]
       Where session = sys_session()
         And codtable = 'SAN'
         And columnname = 'recno';
      -- Busca Conta Bancária e valor da baixa no cabeçalho do Título
      Select an_vencto, an_venctoreal
        Into dVencto, dVenctoR
        From [(san)]
       Where recno = iRecno;
      -- Atualiza a tabela de sessão com a Conta Bancária e o valor da Baixa
      Update [(ss042)]
         Set date_ = dVencto
       Where session = sys_session()
         And Columnname = 'fbr_vencia';
      Update [(ss042)]
         Set date_ = dVenctoR
       Where session = sys_session()
         And Columnname = 'fbr_vencia_r';
   End If;

   out_res := 1;
end;
$$ language plpgsql;
