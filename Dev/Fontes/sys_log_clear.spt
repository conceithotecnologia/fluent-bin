/**
   Registro de Log

	@author    Ricardo Gonçalves
	@date      21/07/2014 13:13:01
	@trigger   
   
   @in_codtable alias da tabela para a qual o log está sendo gerado
   @in_recno registro da tabela para o qual o log está sendo gerado

   @return Código do log gerado

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
create or replace function sys_log_clear####???
(  in in_codtable varchar,
   in in_recno integer)
Returns integer AS 
$$
Declare
   r        record;   
   cmd      text;
   vtable   varchar;
   valias   varchar;
Begin
   select modo
     into r
     from ss009
    where codtable = upper(in_codtable); 
   
   if not Found then
      raise '[[O log para tabela "%", registro "%" não pode ser localizado porque o alias não foi localizado na tabela ss009]]',
         in_codtable, in_recno;
   end if;
   
   if r.modo = 1 then
      valias := 'a4b';
      vtable := 'a4b' || sys_emp####???() || '000';
   elsif r.modo = 2 then
      valias := 'a4c';
      vtable := 'a4c'|| sys_empfil####???();      
   else
      raise '[[Não é possível usar a rotina sys_log para gerar logs para tabelas padrão]]';
   end if;

   cmd := format('delete from %s where codtable = %s and %s_recno = %s;', vtable, quote_literal(upper(in_codtable)), valias, in_recno);   
   execute cmd;
   
   Return 1;
End;
$$ language plpgsql;
